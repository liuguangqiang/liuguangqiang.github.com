I"š<<h2 id="åŸºæœ¬ä»‹ç»">åŸºæœ¬ä»‹ç»</h2>
<p>Retrofitæ˜¯Squareçš„ä¸€ä¸ªéå¸¸çŸ¥åçš„å¼€æºçš„ç½‘ç»œè¯·æ±‚åº“ï¼Œå¹¶ä¸”æ˜¯ç”±Androidå¤§ç¥JakeWhartonäº²è‡ªæ“åˆ€ã€‚</p>

<p>ç°åœ¨Retrofitå·²ç»å‡ºåˆ°2.0.2ç‰ˆæœ¬äº†ï¼Œä¸å‰çš„1.9ç‰ˆæœ¬ç›¸å·®å¾ˆå¤§ï¼Œå¹¶ä¸”å®˜æ–¹å¼ºçƒˆæ¨è2.0ç‰ˆæœ¬ï¼Œæ‰€ä»¥åœ¨æ­¤å°±åªèŠ2.0ä»¥åçš„ç‰ˆæœ¬ã€‚</p>

<h2 id="é©¬ä¸Šå¼€æ’¸">é©¬ä¸Šå¼€æ’¸ï¼</h2>
<p>é¦–å…ˆè‚¯å®šè¦åœ¨build.gradleä¸­æ·»åŠ retrofitçš„ä¾èµ–ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>compile 'com.squareup.retrofit2:retrofit:2.0.2'
</pre></td></tr></tbody></table></code></pre></div></div>

<p>åˆ›å»ºä¸€ä¸ªHTTP APIçš„æ¥å£ã€‚</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"> 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ZhihuService</span> <span class="o">{</span>
   
    <span class="nd">@GET</span><span class="o">(</span><span class="s">"news/latest"</span><span class="o">)</span> 
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">Daily</span><span class="o">&gt;</span> <span class="nf">getLatest</span><span class="o">();</span>
    
<span class="o">}</span></code></pre></figure>

<p>å®ä¾‹åŒ–ZhihuServiceï¼Œç„¶åå‘èµ·HTTPè¯·æ±‚ã€‚</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"> 
<span class="nc">Retrofit</span> <span class="n">retrofit</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Retrofit</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">baseUrl</span><span class="o">(</span><span class="s">"http://news-at.zhihu.com/api/4/"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="nc">ZhihuService</span> <span class="n">service</span> <span class="o">=</span> <span class="n">retrofit</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">ZhihuService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-java" data-lang="java"> 
<span class="nc">Call</span><span class="o">&lt;</span><span class="nc">Daily</span><span class="o">&gt;</span> <span class="n">daily</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getLatest</span><span class="o">();</span></code></pre></figure>

<h2 id="è¯´å¥½çš„rxjavaå‘¢">è¯´å¥½çš„RxJavaå‘¢ï¼Ÿ</h2>

<p>RxJavaåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</p>

<p>Reactive Extensions for the JVM â€“ a library for composing asynchronous and event-based programs using observable sequences for the Java VM.</p>

<p>å¦‚æœä¸ç†Ÿæ‚‰RxJavaçš„æœ‹å‹ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼Œ<a href="http://gank.io/post/560e15be2dca930e00da1083#toc_1">ç»™ Android å¼€å‘è€…çš„ RxJava è¯¦è§£</a></p>

<p>Retrofit2.0ä¾ç„¶æ˜¯æ”¯æŒRxJavaçš„ï¼Œä½†å’Œä»¥å‰çš„é›†æˆåœ¨ä¸€èµ·ä¸åŒï¼Œç°åœ¨æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œéœ€è¦è‡ªå·±æ·»åŠ CallAdapterã€‚è¿™æ ·çš„å¥½å¤„æ˜¯æ›´çµæ´»ï¼Œæ›´è§£è€¦ã€‚</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"> 
<span class="cm">/**
 * Add a call adapter factory for supporting service method return types other than {@link
 * Call}.
 */</span>
<span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">addCallAdapterFactory</span><span class="o">(</span><span class="nc">CallAdapter</span><span class="o">.</span><span class="na">Factory</span> <span class="n">factory</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">adapterFactories</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">checkNotNull</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="s">"factory == null"</span><span class="o">));</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<h2 id="æ·»åŠ rxjavacalladapter">æ·»åŠ RxJavaCallAdapter</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>compile 'com.squareup.retrofit2:adapter-rxjava:2.0.2'
</pre></td></tr></tbody></table></code></pre></div></div>

<figure class="highlight"><pre><code class="language-java" data-lang="java"> 
<span class="nc">Retrofit</span> <span class="n">retrofit</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Retrofit</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">baseUrl</span><span class="o">(</span><span class="no">HOST_NAME</span><span class="o">)</span>
		        <span class="o">.</span><span class="na">addCallAdapterFactory</span><span class="o">(</span><span class="nc">RxJavaCallAdapterFactory</span><span class="o">.</span><span class="na">create</span><span class="o">())</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre></figure>

<h2 id="ç°åœ¨retrofitå¯ä»¥ä½¿ç”¨rxjavaäº†">ç°åœ¨Retrofitå¯ä»¥ä½¿ç”¨RxJavaäº†</h2>

<p><strong>é¦–å…ˆä¿®æ”¹æˆ‘ä»¬çš„APIæ¥å£ã€‚</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"> 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ZhihuService</span> <span class="o">{</span>
	
	 <span class="nd">@GET</span><span class="o">(</span><span class="s">"news/latest"</span><span class="o">)</span>
	 <span class="nc">Observable</span><span class="o">&lt;</span><span class="nc">Daily</span><span class="o">&gt;</span> <span class="nf">getLatest</span><span class="o">();</span>
	     
<span class="o">}</span></code></pre></figure>

<p><strong>RxJavaçš„ä½¿ç”¨åœ¨è¿™é‡Œï¼ï¼</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"> 
    <span class="nc">ZhihuService</span> <span class="n">service</span> <span class="o">=</span> <span class="n">retrofit</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">ZhihuService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="nc">Observable</span><span class="o">&lt;</span><span class="nc">Daily</span><span class="o">&gt;</span> <span class="n">observable</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getLatest</span><span class="o">();</span>
    <span class="n">observable</span><span class="o">.</span><span class="na">subscribeOn</span><span class="o">(</span><span class="nc">Schedulers</span><span class="o">.</span><span class="na">io</span><span class="o">())</span>
            <span class="o">.</span><span class="na">observeOn</span><span class="o">(</span><span class="nc">AndroidSchedulers</span><span class="o">.</span><span class="na">mainThread</span><span class="o">())</span>
            <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="k">new</span> <span class="nc">Observer</span><span class="o">&lt;</span><span class="nc">Daily</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onError</span><span class="o">(</span><span class="nc">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onNext</span><span class="o">(</span><span class="nc">Daily</span> <span class="n">daily</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>
    <span class="o">});</span></code></pre></figure>

<h2 id="retrofit-converterçš„ä½¿ç”¨">Retrofit Converterçš„ä½¿ç”¨</h2>
<p>Converterå’ŒCallAdapterä¸€æ ·ï¼Œä¹Ÿä»Retrofitä¸­åˆ†ç¦»å‡ºæ¥ï¼Œéœ€è¦è‡ªå·±æ·»åŠ ã€‚å®˜æ–¹æä¾›äº†å¾ˆå¤šconvertes.</p>

<ul>
  <li>gson</li>
  <li>jackson</li>
  <li>moshi</li>
  <li>protobuf</li>
  <li>scalars</li>
  <li>simplexml</li>
  <li>wire</li>
</ul>

<p>ä½†æ˜¯å‘ç°æ²¡æœ‰LoganSqaureï¼Œé‚£åªæœ‰è‡ªå·±æ’¸äº†ï¼Œè¿˜å¥½åœ¨githubä¸Šå·²ç»æœ‰å†™å¥½çš„ï¼Œæ˜¯æ—¶å€™å‘æŒ¥æˆ‘ä»¬çš„æ‹¿æ¥ä¸»ä¹‰çš„ç²¾ç¥äº†ï¼Œä¸ç„¶æ€ä¹ˆè¯´æˆ‘ä»¬éƒ½æ˜¯githubçš„æ¬è¿å·¥å‘¢ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>complie 'com.github.aurae.retrofit2:converter-logansquare:1.4.0'
</pre></td></tr></tbody></table></code></pre></div></div>

<figure class="highlight"><pre><code class="language-java" data-lang="java"> 
<span class="nc">Retrofit</span> <span class="n">retrofit</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Retrofit</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">baseUrl</span><span class="o">(</span><span class="no">HOST_NAME</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addConverterFactory</span><span class="o">(</span><span class="nc">LoganSquareConverterFactory</span><span class="o">.</span><span class="na">create</span><span class="o">())</span>
                <span class="o">.</span><span class="na">addCallAdapterFactory</span><span class="o">(</span><span class="nc">RxJavaCallAdapterFactory</span><span class="o">.</span><span class="na">create</span><span class="o">())</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre></figure>

<h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨logansquareæ¥è§£æjson">ä¸ºä»€ä¹ˆä½¿ç”¨LoganSquareæ¥è§£æJSONï¼Ÿ</h2>

<p>å¤©ä¸‹æ­¦åŠŸå”¯å¿«ä¸ç ´ï¼å› ä¸ºLoganSquareå¿«å•Šï¼</p>

<p><img src="/img/1461222338634.png" alt="image" /></p>

<p>Note: Our â€œ400% or moreâ€ performance improvement metric was determined using ART. While LoganSquare still comes out on top with Dalvik, it seems as though the comparison is much closer. The benchmarks shown are actual screenshots taken from a 2nd gen Moto X.</p>

<h4 id="æ·»åŠ logansquare">æ·»åŠ LoganSquare</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'com.neenbedankt.gradle.plugins:android-apt:1.8'
    }
}
apply plugin: 'com.neenbedankt.android-apt'

dependencies {
    apt 'com.bluelinelabs:logansquare-compiler:1.3.6'
    compile 'com.bluelinelabs:logansquare:1.3.6'
}
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="æ‰“å°log">æ‰“å°Log</h2>
<p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰“å°Httpè¯·æ±‚çš„Logï¼Œè¿™æ ·æ–¹ä¾¿è°ƒè¯•ã€‚åœ¨è€ç‰ˆæœ¬çš„Retrofitä¸­ï¼Œæœ‰ä¸ªæ–¹æ³•</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"> 
<span class="k">new</span> <span class="nc">RestAdapter</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">setLogLevel</span><span class="o">(</span><span class="nc">RestAdapter</span><span class="o">.</span><span class="na">LogLevel</span><span class="o">.</span><span class="na">FULL</span><span class="o">);</span></code></pre></figure>

<p>ä½†æ˜¯ï¼Œåœ¨Retrofit2.0åï¼Œä¸å†æä¾›è¯¥æ–¹æ³•äº†ï¼Œéœ€è¦ä¾èµ–okhttpä¸­çš„HttpLoggingInterceptorã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>compile 'com.squareup.okhttp3:logging-interceptor:3.0.1'
</pre></td></tr></tbody></table></code></pre></div></div>

<figure class="highlight"><pre><code class="language-java" data-lang="java"> 
<span class="nc">HttpLoggingInterceptor</span> <span class="n">interceptor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpLoggingInterceptor</span><span class="o">();</span>
        <span class="n">interceptor</span><span class="o">.</span><span class="na">setLevel</span><span class="o">(</span><span class="nc">HttpLoggingInterceptor</span><span class="o">.</span><span class="na">Level</span><span class="o">.</span><span class="na">HEADERS</span><span class="o">);</span>
        <span class="nc">OkHttpClient</span> <span class="n">okHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="n">interceptor</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-java" data-lang="java"> 
<span class="nc">Retrofit</span> <span class="n">retrofit</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Retrofit</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">baseUrl</span><span class="o">(</span><span class="no">HOST_NAME</span><span class="o">)</span>
                <span class="o">.</span><span class="na">client</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addConverterFactory</span><span class="o">(</span><span class="nc">LoganSquareConverterFactory</span><span class="o">.</span><span class="na">create</span><span class="o">())</span>
                <span class="o">.</span><span class="na">addCallAdapterFactory</span><span class="o">(</span><span class="nc">RxJavaCallAdapterFactory</span><span class="o">.</span><span class="na">create</span><span class="o">())</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre></figure>

<h2 id="çœ‹äº†è¿™ä¹ˆå¤šæºç å‘¢">çœ‹äº†è¿™ä¹ˆå¤šï¼Œæºç å‘¢ï¼Ÿ</h2>
<p>æºç å½“ç„¶è¦çŒ®ä¸Šçš„ï¼Œä¹‹å‰çš„ä¸€ä¸ªå¼€æºçš„APPå«<a href="https://github.com/liuguangqiang/Idaily">IDaily</a>ï¼Œå…¶ä¸­çš„HTTPè¯·æ±‚å°±æ˜¯é‡‡ç”¨çš„Retrofit2+RxJava+LoganSquareï¼Œæ•¢å…´è¶£çš„æœ‹å‹ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ã€‚</p>

<p>##Thatâ€™s all!
åˆ°æ­¤å°±ç»“æŸäº†, åˆæ¬¡å†™ç±»ä¼¼çš„æ–‡ç« ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œæœ›è§è°…ï¼è°¢è°¢ï¼</p>
:ET